# from: https://github.com/tmux-plugins/tmux-sensible ----
set -s escape-time 0
set-option -g display-time 100
set -g history-limit 50000
set -g status-interval 5
set -g status-keys emacs
set -g focus-events on
setw -g aggressive-resize on
# --------------------------------------------------------

#set-option -g status-position top

# Fix vim background color
#set -g terminal-overrides ',xterm-256color:Tc'
#set -as terminal-overrides ',xterm*:sitm=\E[3m'
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ",xterm-256color:Tc"


# Fix Esc-j and Esc-k swap lines 
unbind-key -T root M-k
unbind-key -T root M-j
unbind-key -T root M-h # prev window
unbind-key -T root M-l # next window

bind r source-file ~/.config/tmux/tmux.conf
bind q kill-pane
bind Q kill-window
bind c detach-client
bind-key  -n M-q kill-pane
bind-key  -n M-Q kill-window

set -s command-alias[50] vsp='split-window -h'
set -s command-alias[51] sp='split-window '
set -s command-alias[52] q='kill-session'

set -g mouse on

# Prefix is Alt+w
unbind C-b
set-option -g prefix M-w
bind-key M-w send-prefix

# alt-w + hjkl -> switch to panels (analog to vim's ctrl-w)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Focus panel with Alt-{hjkl}
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# Resize panel with Alt-shift {hjkl}
bind-key -n M-H resize-pane -L 1
bind-key -n M-J resize-pane -D 1
bind-key -n M-K resize-pane -U 1
bind-key -n M-L resize-pane -R 1

# ALt-ww -> switch to previos panel
#bind w last-pane
#bind M-w last-pane
bind w select-pane -l 
bind M-w select-pane -l





# Open panel
bind i split-window -v -c '#{pane_current_path}'
bind o split-window -h -c '#{pane_current_path}'

# Start windows and panes at 1, not 0
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1

# alt-1234567890 switch to window 
bind-key -n M-0 select-window -t 0
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# alt-shift-1234567890 move selected pane to window
# bind-key j command-prompt -p "join pane from:"  "join-pane -s '%%'"
# bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"
bind-key -n 'M-=' join-pane -t 0.0
bind-key -n 'M-!' join-pane -t 1.1
bind-key -n 'M-"' join-pane -t 2.1
bind-key -n 'M-·' join-pane -t 3.1 # This one does not work 
bind-key -n 'M-$' join-pane -t 4.1
bind-key -n 'M-%' join-pane -t 5.1
bind-key -n 'M-&' join-pane -t 6.1
bind-key -n 'M-/' join-pane -t 7.1
bind-key -n 'M-(' join-pane -t 8.1
bind-key -n 'M-)' join-pane -t 9.1

bind 0 join-pane -t 0.0
bind 1 join-pane -t 1.1
bind 2 join-pane -t 2.1
bind 3 join-pane -t 3.1
bind 4 join-pane -t 4.1
bind 5 join-pane -t 5.1
bind 6 join-pane -t 6.1
bind 7 join-pane -t 7.1
bind 8 join-pane -t 8.1
bind 9 join-pane -t 9.1

bind : command-prompt
bind-key -n 'M-:' command-prompt

# bind alt-r rename window
bind-key -n M-r command-prompt -p "rename window:"  "rename-window '%%'"
bind-key -n M-R command-prompt -p "rename session:"  "rename-session '%%'"

# Alt+Space -> enter ESC mode
bind-key -n M-space copy-mode

# Different ways to leave copy mode
bind-key    -T copy-mode-vi M-space  send-keys -X cancel
bind-key    -T copy-mode-vi q        send-keys -X cancel
bind-key    -T copy-mode-vi Escape   send-keys -X cancel

# Copy paste with C-c or y and exit
bind-key    -T copy-mode-vi C-c      send-keys -X copy-selection-and-cancel
bind-key    -T copy-mode-vi y        send-keys -X copy-selection-and-cancel

bind-key    -T copy-mode-vi C-D      send -X page-down
bind-key    -T copy-mode-vi C-U      send -X page-up

# Scroll with Alt-u and Alt-d
bind -n M-u copy-mode -e \; send-keys -X scroll-up
bind -n M-d copy-mode -e \; send-keys -X scroll-down

# Page up and down with Alt-Shift-U and Alt-Shift-D
bind -n M-U copy-mode -e \; send-keys -X halfpage-up
bind -n M-D copy-mode -e \; send-keys -X halfpage-down

# Alt-n -> new window
bind-key -n M-n new-window
bind n new-window

# ALt-s -> search sessions
bind-key -n M-s choose-tree -Z

# Disable tmux copy paste while keeping mouse on (for scrolling)
unbind-key -T root MouseDown2Pane
unbind-key -T root MouseDragEnd1Pane
set -g set-clipboard external

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'mocha' # or frappe, macchiato, mocha
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
#set -g @continuum-restore 'on'

# Set background for the status bar
#set -g @catppuccin_window_right_separator "#[fg=#313244,bg=#181825]█ "
#set -g @catppuccin_status_left_separator "█"
#set -g @catppuccin_status_left_separator "#[bg=#181825] █" 
#set -g @catppuccin_window_current_fill "number"

set -g @catppuccin_window_right_separator "█"
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_left_separator "█" 
set -g @catppuccin_window_current_fill "number"

set -g @catppuccin_status_modules_right "session user host"
#set -g @catppuccin_directory_text "#{pane_current_path}"
set -g @catppuccin_window_current_text "#W" 
set -g @catppuccin_window_default_text "#W" 

set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_status_left_separator_inverse "no"
set -g @catppuccin_status_fill "all"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run  '~/.config/tmux/plugins/tpm/tpm'

set -g pane-border-style fg="#313244"
set -g pane-active-border fg="#313244"
set -g status-bg "#181825"

# Highlight panes on focus (only when there's more than 1)
set-hook -g after-select-pane "if-shell -F '#{==:#{window_panes},1}' '' 'selectp -P bg=#252536; run \"sleep 0.1\"; selectp -P bg=default'"

# Change color of selected text 
set -g mode-style "reverse"

# Style command prompt / dialogs 
set -g message-style 'bg=#181825 fg=default'

#if-shell "[[ $(tmux list-panes | wc -l) -gt 1 ]]" \
#  'set-hook -g pane-focus-in "selectp -P bg=#252536; run \"sleep 0.1\"; selectp -P bg=default"'

# TODO ! better than zsh function?
# tmux set-hook client-detached kill-session
# set-hook -g after-detach "run-shell /path/to/cleanup_tmux_sessions.sh"
# or 
# set -g detach-on-destroy on
# tmux set -g detach-on-destroy on

#set -g focus-events on
#set -g status-left-length 90
#set -g status-right-length 90
#set -g status-justify centre

